# Troubleshooting

This topic contains troubleshooting and known issues for Supply Chain Security Tools - Store.

## Persistent volume retains data

### Symptom

If Supply Chain Security Tools - Store is deployed, deleted, and then redeployed the
`metadata-store-db` Pod fails to start up if the database password changed during redeployment.
This is due to the persistent volume used by postgres retaining old data, even though the retention
policy is set to `DELETE`.

### <a id='persistent-volume-retains-data-solution'></a>Solution

> **Warning:** Changing the database password deletes your Supply Chain Security Tools - Store data.

To redeploy the app either use the same database password or follow the steps below to erase the
data on the volume:

1. Deploy metadata-store app through kapp.
1. Verify that the `metadata-store-db-*` Pod fails.
1. Run:

    ```
    kubectl exec -it metadata-store-db-<some-id> -n metadata-store /bin/bash
    ```
    Where `<some-id>` is the ID generated by Kubernetes and appended to the Pod name.
1. Run `rm -rf /var/lib/postgresql/data/*` to delete all database data.
This is the path found in `postgres-db-deployment.yaml`.
1. Delete the `metadata-store` app through kapp.
1. Deploy the `metadata-store` app through kapp.


## Missing persistent volume

### Symptom

After Store is deployed, `metadata-store-db` Pod could fail for missing volume while
`postgres-db-pv-claim` pvc is in `PENDING` state.
This issue could be occurring because the cluster where Store is deployed does not have
`storageclass` defined.
`storageclass`'s provisioner is responsible for creating the persistent volume after
`metadata-store-db` attaches `postgres-db-pv-claim`.

### <a id='missing-persistent-volume-solution'></a>Solution

1. Verify that your cluster has `storageclass` by running `kubectl get storageclass`.
1. Create a `storageclass` in your cluster before deploying Store, for example:

    ```
    # This is the storageclass that Kind uses
    kubectl apply -f https://raw.githubusercontent.com/rancher/local-path-provisioner/master/deploy/local-path-storage.yaml
    
    # set the storage class as default
    kubectl patch storageclass local-path -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
    ```
